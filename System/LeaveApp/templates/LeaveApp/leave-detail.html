{% extends 'LeaveApp/base.html' %}

<title>Employee {% block title %}
    {% endblock %}
</title>

{% block content %}
<div class="app-content-padding flex-grow-1 overflow-hidden ps" data-scrollbar="true" data-height="100%" style="height: 100%;">
    <!-- BEGIN breadcrumb -->
    
    <!-- BEGIN panel -->
    <div class="panel panel-inverse">
        <div class="panel-heading">
            {% comment %} <h4 class="panel-title" data-bs-toggle="offcanvas" class="btn btn-default" href="#offcanvasBottomExample">
                <button type="button">Leave balance</button></h4> {% endcomment %}
            <h4 class="panel-title"></h4>
            <div class="panel-heading-btn">
                <a href="javascript:;" class="btn btn-xs btn-icon btn-default" data-toggle="panel-expand"><i class="fa fa-expand"></i></a>
                <a href="javascript:;" class="btn btn-xs btn-icon btn-success" data-toggle="panel-reload"><i class="fa fa-redo"></i></a>
                <a href="javascript:;" class="btn btn-xs btn-icon btn-warning" data-toggle="panel-collapse"><i class="fa fa-minus"></i></a>
                <a href="javascript:;" class="btn btn-xs btn-icon btn-danger" data-toggle="panel-remove"><i class="fa fa-times"></i></a>
            </div>
        </div>
        <div class="panel-body">
            <div id="printArea">
                
                <table id="tableToPrint" class="table table-striped table-bordered align-middle" style='font-family:"Courier New", Courier, font-size:80%'>
                    <thead>
                        
                        <tr>
                            <th>Employee Details</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Employee Full Name</td>
                            <td>{{ user.first_name }} {{ user.last_name }}</td>
                        </tr>
                        <tr>
                            <td>Email</td>
                            <td>{{ user.email }}</td>
                        </tr>
                        <tr>
                            <td>Department</td>
                            <td>{{ employee_instance.department }}</td>
                        </tr>
                        <tr>
                            <td>Unit</td>
                            <td>{{ employee_instance.unit }}</td>
                        </tr>
                        <tr>
                            <th>Leave Details</th>
                        </tr>
            
                        <tr>
                            <td>Type of leave</td>
                            <td>{{ leave.leave_type_id.type_name }}</td>
                            
                        </tr>
                        <tr>
                            <td>Status</td>
                            <td>{{ status_update }}</td>
                        </tr>
                        <tr>
                            <td>Date Applied</td>
                            <td>{{ leave.date_applied }}</td>
                            
                        </tr>
                        <tr>
                            <td>Number of Days</td>
                            <td>{{ leave.no_of_days }}</td>
                        </tr>
                        <tr>
                            <td>Start Date</td>
                            <td>{{ leave.start_date }}</td>
                            
                        </tr>
                        <tr>
                            <td>End Date</td>
                            <td>{{ leave.end_date }}</td>
                        </tr>
                        <tr>
                            <td>Backstop</td>
                            <td>{{ subtitute_name }}</td>
                           
                        </tr>
                        <tr>
                            <td>Project Name</td>
                            <td>{{ project_name }}</td>
                        </tr>
                        <tr>
                            <td>Reasons</td>
                            <td>{{ leave.comments }}</td>
                        </tr>
                        <tr>
                            <td>Supervisor's comments</td>
                            <td>{{ leave.sub_comments }}</td>
                        </tr>
                    </tbody>
                </table>
                <div class="col-md-12 text-end">
                    <button onclick="printTable()" class="btn btn-primary me-1">Print</button>
                </div>
            </div>
        </div>
    
        <script>
            function printTable() {
                const printArea = document.getElementById('printArea');
                const tableElement = document.getElementById('tableToPrint');
        
                const printWindow = window.open('', '_blank', 'height=600,width=800');
                const printDoc = printWindow.document;
        
                const tableClone = tableElement.cloneNode(true);
                const styleTags = document.getElementsByTagName('style');
                const linkTags = document.getElementsByTagName('link');
        
                // Remove the date, time, and "about:blank" from the document content
                const documentContent = tableClone.outerHTML.replace(/(\d+\/\d+\/\d+, \d+:\d+)|about:blank/g, '');
        
                printDoc.open();
                printDoc.write(`
                    <html>
                        <head>
                            <title>LEAVE APPLICATION FORM</title>
                            <style>
                                .title {
                                    font-size: 24px; 
                                }
                            </style>
                            ${Array.from(styleTags).map(tag => tag.outerHTML).join('')}
                            ${Array.from(linkTags).map(tag => tag.outerHTML).join('')}
                            
                        </head>
                        <body>
                            ${documentContent}
                        </body>
                    </html>
                `);
                printDoc.close();
        
                 printWindow.print();
        
                printWindow.addEventListener('afterprint', () => {
                    printWindow.close();
                });
            }
        </script>
    </div>
</div>
{% endblock %}

